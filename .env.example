# === SoVAni Bot Configuration Example ===
# Copy this file to .env and fill in your actual values
# DO NOT commit .env file to git!

# === Telegram (REQUIRED) ===
TELEGRAM_TOKEN=123456789:ABCdefGHIjklMNOpqrsTUVwxyz
MANAGER_CHAT_ID=123456789

# === Wildberries API (REQUIRED - 6 tokens) ===
# See: https://seller.wildberries.ru/supplier-settings/access-to-api
WB_FEEDBACKS_TOKEN=eyJhbGciOiJFUzI1NiIsImtpZCI6...  # Отзывы/вопросы/чат
WB_ADS_TOKEN=eyJhbGciOiJFUzI1NiIsImtpZCI6...       # Продвижение (реклама)
WB_STATS_TOKEN=eyJhbGciOiJFUzI1NiIsImtpZCI6...     # Статистика и финансы
WB_SUPPLY_TOKEN=eyJhbGciOiJFUzI1NiIsImtpZCI6...    # Поставки и возвраты
WB_ANALYTICS_TOKEN=eyJhbGciOiJFUzI1NiIsImtpZCI6... # Аналитика и документы
WB_CONTENT_TOKEN=eyJhbGciOiJFUzI1NiIsImtpZCI6...   # Контент, цены, скидки

# WB Private Key for JWT signing (path to .pem file)
WB_PRIVATE_KEY_PATH=/root/sovani_bot/wb_private_key.pem

# === Ozon API (REQUIRED) ===
OZON_CLIENT_ID=12345
OZON_API_KEY_ADMIN=abc-def-ghi-jkl-mno

# Ozon Performance API (optional, for advertising)
OZON_PERF_CLIENT_ID=perf-client-id
OZON_PERF_CLIENT_SECRET=perf-secret

# === OpenAI (REQUIRED) ===
OPENAI_API_KEY=sk-...
OPENAI_MODEL=gpt-4o-mini

# Legacy ChatGPT API key (optional, falls back to OPENAI_API_KEY)
CHATGPT_API_KEY=sk-...

# === Database (PostgreSQL - Stage 7) ===
# Production: PostgreSQL with connection pooling
DATABASE_URL=postgresql+psycopg2://sovani:YOUR_PASSWORD@localhost:5432/sovani

# Legacy SQLite (Stage 0-6 compatibility)
# DATABASE_URL=sqlite:///./sovani_bot.db

# === Data Aggregation Windows ===
AGGR_DAYS_WB=14     # Rolling velocity window for WB (days)
AGGR_DAYS_OZON=28   # Rolling velocity window for Ozon (days)

# === Business Settings ===
DEFAULT_COST_PRICE=600.0
COST_PRICE=600.0

# === Review Check Settings ===
REVIEW_CHECK_HOUR=6
REVIEW_CHECK_MINUTE=0

# === Stock Settings ===
WB_MIN_STOCK_DAYS=14
OZON_MIN_STOCK_DAYS=21
OZON_HIGH_STOCK_DAYS=45

# === Application Settings ===
APP_TIMEZONE=Europe/Moscow
HTTP_TIMEOUT_SECONDS=30

# === Logging Settings ===
# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL=INFO

# JSON log file path (leave empty to disable file logging, only stdout for journalctl)
# Default: /var/log/sovani-bot/bot.jsonl
LOG_FILE=/var/log/sovani-bot/bot.jsonl

# Log file rotation settings
LOG_MAX_BYTES=5242880  # 5MB
LOG_BACKUP_COUNT=5

# === HTTP/Rate limits (per host, tune as needed) ===
# Wildberries API rate limits
WB_RATE_PER_MIN=60  # Max 60 requests per minute for most endpoints
WB_RATE_CAPACITY=60

# Ozon API rate limits
OZON_RATE_PER_MIN=300  # Varies by method, 200-1000 req/min typical
OZON_RATE_CAPACITY=300

# === Circuit breaker settings ===
CB_FAIL_THRESHOLD=5  # Open circuit after N consecutive failures
CB_RESET_TIMEOUT=30  # Seconds before trying half-open state

# === HTTP retry/backoff settings ===
HTTP_MAX_RETRIES=3  # Maximum retry attempts for failed requests
HTTP_BACKOFF_BASE=0.75  # Base delay in seconds for exponential backoff
HTTP_BACKOFF_MAX=8.0  # Maximum backoff delay in seconds

# === Web API & RBAC (Stage 10) ===
# Comma-separated Telegram user IDs
ALLOWED_TG_USER_IDS=123456789,987654321  # Admin users (full access)
READONLY_TG_USER_IDS=555555555,666666666  # Viewer users (read-only)

# TMA origin for CORS (production)
TMA_ORIGIN=https://your.domain.com

# === Monitoring & Alerts (Stage 11) ===
# Alert thresholds
ALERT_THRESHOLD_DISK=90  # Disk usage alert threshold (%)
ALERT_THRESHOLD_MEMORY=90  # Memory usage alert threshold (%)
ALERT_THRESHOLD_JOB_FAILURES=3  # Consecutive job failures before alert

# Logging
ENABLE_JSON_LOGGING=false  # Enable JSON structured logging
LOG_LEVEL=INFO  # Logging level: DEBUG, INFO, WARNING, ERROR, CRITICAL

# === Legacy Settings (will be removed in Stage 6) ===
# These are kept for backward compatibility
REPORTS_DIR=reports
DB_FILE=sovani_bot.db
TIMEZONE=Europe/Moscow

# === Answer Engine (Stage 12) ===
# Review classification thresholds
REVIEW_SHORT_WORDS_MAX=4  # Max words for "short" review
REVIEW_LONG_CHARS_MIN=40  # Min chars for "long" review
TEMPLATES_LOCALE=ru  # Template language (ru/en)

# === Supply Planner (Stage 13) ===
# Planning windows: WB=14 days, Ozon=28 days
PLANNER_SAFETY_COEFF=1.2  # Safety stock coefficient (multiplier for demand volatility)
PLANNER_MIN_BATCH=5  # Minimum batch size for replenishment
PLANNER_MULTIPLICITY=1  # Order quantity must be multiple of this value
PLANNER_MAX_PER_SLOT=500  # Maximum quantity per delivery slot
WAREHOUSE_CAPACITY_JSON={}  # Warehouse capacity limits by location (JSON): {"WB:Казань": 15000, "OZON:СПБ": 12000}
CASHFLOW_LIMIT=0  # Cash flow budget limit (0 = unlimited)
PLANNER_SOLVER=heuristic  # Planning algorithm: "heuristic" or "pulp" (MILP)

# === Pricing & Promo (Stage 14) ===
# Price elasticity and promotion analytics
PRICING_MIN_MARGIN_PCT=0.10  # Minimum profit margin (10% default)
PRICING_MAX_DISCOUNT_PCT=0.30  # Maximum allowed discount without explicit approval
PRICING_MIN_PRICE_STEP=10  # Minimum price change step (rubles)
PRICING_MAP_JSON={}  # Minimum advertised price (MAP) by SKU: {"SKU123": 990, "SKU456": 1490}
PROMO_MIN_WINDOW_DAYS=7  # Minimum comparison window for promo effects
PROMO_MAX_WINDOW_DAYS=28  # Maximum comparison window for promo effects
PRICING_EXPLAIN_SERVICE_LEVEL=0.88  # Service level for context in explanations

# === BI Export (Stage 15) ===
# Power BI / Metabase integration
BI_EXPORT_MAX_ROWS=100000  # Maximum rows per export request
BI_EXPORT_DEFAULT_LIMIT=5000  # Default limit for export queries
BI_READONLY_DB_USER=bi_reader  # Read-only database user for BI tools

# === Cashflow & PnL Pro (Stage 16) ===
# Cash flow and actual P&L analysis
CF_DEFAULT_SETTLEMENT_LAG_DAYS=7  # Average payment lag from marketplace to seller
CF_NEGATIVE_BALANCE_ALERT_THRESHOLD=-10000  # Alert threshold for negative cash balance
PNL_COST_FALLBACK_STRATEGY=latest  # Cost price strategy: "latest" or "moving_avg_28"
PNL_REFUNDS_RECOGNITION=post_event  # Refund recognition: "post_event" or "order_date"
SCENARIO_MAX_LOOKAHEAD_DAYS=28  # Maximum what-if scenario horizon
SCENARIO_PRICE_STEP=10  # Price step for simulations (rubles)
SCENARIO_SUPPLY_LEADTIME_DAYS=5  # Average supply lead time (days)

# === Alerts & Playbooks (Stage 17) ===
# Operational alerts and auto-remediation
ALERT_CHAT_IDS=  # Comma-separated Telegram chat IDs for alerts
ALERT_DEDUP_WINDOW_SEC=300  # Alert deduplication window (seconds)
ALERT_MIN_SEVERITY=warning  # Minimum severity to send: warning|error|critical
SLO_API_LATENCY_P95_MS=1200  # SLO: API p95 latency target (ms)
SLO_INGEST_SUCCESS_RATE_PCT=99.0  # SLO: Ingestion success rate (%)
SLO_SCHEDULER_ON_TIME_PCT=98.0  # SLO: Scheduler on-time execution (%)
AUTO_REMEDIATION_ENABLED=true  # Enable automatic remediation actions
AUTO_REMEDIATION_MAX_RETRIES=3  # Max remediation retry attempts

# === Reviews SLA (Stage 18) ===
# Time to First Reply (TTFR) and escalation management
SLA_FIRST_REPLY_HOURS=24  # SLA target: first reply within N hours
SLA_ESCALATE_AFTER_HOURS=12  # Escalate reviews without reply after N hours
SLA_NOTIFY_CHAT_IDS=  # Comma-separated Telegram chat IDs for SLA escalations
SLA_BACKLOG_LIMIT=200  # Maximum reviews to check in backlog
SLA_BATCH_SIZE=30  # Reviews per escalation message batch

# === Multi-Tenant SaaS (Stage 19) ===
# Organizations, users, RBAC, data isolation, quotas
DEFAULT_ORG_NAME=SoVAni Default  # Default organization name for new users
TENANT_ENFORCEMENT_ENABLED=true  # Enforce org_id scoping on all queries
ORG_EXPORT_DEFAULT_LIMIT=5000  # Default row limit for exports per org
ORG_EXPORT_MAX_ROWS=100000  # Maximum export rows per org
ORG_RATE_LIMIT_RPS=10  # Max requests per second per organization
ORG_MAX_JOBS_ENQUEUED=50  # Max concurrent jobs per organization
ORG_TOKENS_ENCRYPTION_KEY=  # Base64 encryption key for marketplace credentials (leave empty to disable)
