# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –†–∞—Å—á–µ—Ç–æ–≤ –§–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –û—Ç—á–µ—Ç–æ–≤

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ü—Ä–æ–±–ª–µ–º—ã

### 1. **Wildberries "–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤"**
**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è `totalPrice` (—Ü–µ–Ω–∞ –¥–æ –≤—Å–µ—Ö —Å–∫–∏–¥–æ–∫), —á—Ç–æ –∑–∞–≤—ã—à–∞–ª–æ —Å—É–º–º—ã.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```python
# –ë–´–õ–û (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
total_orders_value += total_price  # –ó–∞–≤—ã—à–µ–Ω–Ω–∞—è —Ü–µ–Ω–∞

# –°–¢–ê–õ–û (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
actual_orders_value += price_with_disc  # –†–µ–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–æ–≤
```

**–õ–æ–≥–∏–∫–∞:** –¢–µ–ø–µ—Ä—å "–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤" = —Å—É–º–º–∞ –≤—Å–µ—Ö `priceWithDisc` (—Ü–µ–Ω–∞ –ø–æ—Å–ª–µ —Å–∫–∏–¥–∫–∏ –ø—Ä–æ–¥–∞–≤—Ü–∞), —á—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–º —Å—É–º–º–∞–º –∑–∞–∫–∞–∑–æ–≤.

### 2. **–†–µ–∫–ª–∞–º–∞ WB = 0**
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–æ—Å—å –ø–æ–ª–µ `paymentSaleAmount` –∫–∞–∫ —Ä–µ–∫–ª–∞–º–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```python
# –ë–´–õ–û (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
sales_advertising_costs += payment_sale_amount  # –≠—Ç–æ –ù–ï —Ä–µ–∫–ª–∞–º–∞!

# –°–¢–ê–õ–û (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
from wb_advertising_fix import get_wb_advertising_for_period
wb_advertising_costs = await get_wb_advertising_for_period(date_from, date_to)
```

**–õ–æ–≥–∏–∫–∞:** –†–µ–∫–ª–∞–º–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã WB –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∞—Ç—å –∏–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ Adv API, –∞ –Ω–µ –∏–∑ Sales API.

### 3. **WB "112 —Å–∫–ª–∞–¥–æ–≤"**
**–ü—Ä–æ–±–ª–µ–º–∞:** –°—á–∏—Ç–∞–ª–∏—Å—å –≤—Å–µ –∑–∞–ø–∏—Å–∏ –æ—Å—Ç–∞—Ç–∫–æ–≤ (–ø–æ —Ä–∞–∑–º–µ—Ä–∞–º) –∫–∞–∫ —Å–∫–ª–∞–¥—ã.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```python
# –ë–´–õ–û (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
wb_count = len(wb_stocks)  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π —Ä–∞–∑–º–µ—Ä–æ–≤
summary = f"–Ω–∞ {wb_count:,} —Å–∫–ª–∞–¥–∞—Ö"

# –°–¢–ê–õ–û (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
wb_warehouses = set()
for item in wb_stocks:
    warehouse = item.get('warehouseName', '')
    if warehouse:
        wb_warehouses.add(warehouse)
wb_warehouses_count = len(wb_warehouses)
summary = f"({wb_size_variants:,} —Ä–∞–∑–º–µ—Ä–æ–≤, {wb_warehouses_count} —Å–∫–ª–∞–¥–æ–≤)"
```

**–õ–æ–≥–∏–∫–∞:** –¢–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞–∑–¥–µ–ª—è–µ–º:
- **–¢–æ–≤–∞—Ä—ã** - —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –±–∞—Ä–∫–æ–¥—ã
- **–†–∞–∑–º–µ—Ä—ã** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π (size variants)
- **–°–∫–ª–∞–¥—ã** - —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ `warehouseName`

## üìä –ù–æ–≤–∞—è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –û—Ç—á–µ—Ç–∞

### Wildberries
```
üü£ Wildberries (–¥–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä):
‚Ä¢ –í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤: 41,036 ‚ÇΩ (21 –µ–¥.)     # = —Å—É–º–º–∞ priceWithDisc
‚Ä¢ –î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ: 41,036 ‚ÇΩ (21 –æ–ø–µ—Ä–∞—Ü–∏–π)   # = —Ç–æ –∂–µ —Å–∞–º–æ–µ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π
‚Ä¢ –ö–æ–º–∏—Å—Å–∏—è WB + —ç–∫–≤–∞–π—Ä–∏–Ω–≥: 10,473 ‚ÇΩ (25.5%)
‚Ä¢ –õ–æ–≥–∏—Å—Ç–∏–∫–∞ + —Ö—Ä–∞–Ω–µ–Ω–∏–µ: 2,299 ‚ÇΩ (5.6%)
‚Ä¢ –†–µ–∫–ª–∞–º–∞ WB: 0 ‚ÇΩ (0.0%)              # –ò–∑ Adv API (–ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω)
‚Ä¢ –ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–∫—É–ø–∞: 100.0%               # forPay / priceWithDisc
```

### –û—Å—Ç–∞—Ç–∫–∏ –Ω–∞ —Å–∫–ª–∞–¥–∞—Ö
```
üì¶ –û–°–¢–ê–¢–ö–ò –ù–ê –°–ö–õ–ê–î–ê–•
‚Ä¢ WB: 38 —Ç–æ–≤–∞—Ä–æ–≤ (112 —Ä–∞–∑–º–µ—Ä–æ–≤, 3 —Å–∫–ª–∞–¥–∞), 649 –µ–¥–∏–Ω–∏—Ü
‚Ä¢ Ozon: 67 —Ç–æ–≤–∞—Ä–æ–≤ (43 –Ω–∞ —Å–∫–ª–∞–¥–µ, 24 –Ω—É–ª–µ–≤—ã–µ –æ—Å—Ç–∞—Ç–∫–∏), 328 –µ–¥–∏–Ω–∏—Ü
```

## üéØ –°–ª–µ–¥—É—é—â–∏–µ –®–∞–≥–∏

### 1. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è WB Adv API
–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö —Ä–µ–∫–ª–∞–º–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω—É–∂–Ω–æ:
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å WB Adv API client
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã –≤ `wb_advertising_fix.py`
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –æ—Ç—á–µ—Ç–∞–º–∏

### 2. –í–∞–ª–∏–¥–∞—Ü–∏—è –ü—Ä–æ—Ü–µ–Ω—Ç–∞ –í—ã–∫—É–ø–∞
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É —Ä–∞—Å—á–µ—Ç–∞:
```python
# –ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–∫—É–ø–∞ –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π conversion
buyout_rate = (final_revenue / actual_orders_value) * 100
```

### 3. –£–ª—É—á—à–µ–Ω–∏–µ –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –¢–æ–≤–∞—Ä–æ–≤
- WB: –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ `supplierArticle` + `subject`
- Ozon: –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –±–∞–∑–æ–≤–æ–º—É –∞—Ä—Ç–∏–∫—É–ª—É –±–µ–∑ —Ä–∞–∑–º–µ—Ä–æ–≤

## ‚ö° –°—Ç–∞—Ç—É—Å –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
- –ó–∞–≤—ã—à–µ–Ω–Ω—ã–µ —Å—É–º–º—ã –∑–∞–∫–∞–∑–æ–≤ WB
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Å—á–µ—Ç —Å–∫–ª–∞–¥–æ–≤
- –õ–æ–≥–∏–∫–∞ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤

üîÑ **–í —Ä–∞–±–æ—Ç–µ:**
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è WB Adv API –¥–ª—è —Ä–µ–∫–ª–∞–º—ã
- –¢–æ—á–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –≤—ã–∫—É–ø–∞

‚ùå **–ù—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:**
- WB Advertising API client
- –î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –∫–∞–º–ø–∞–Ω–∏—è–º
- –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∫–ª–∞–º—ã —Å –ø—Ä–æ–¥–∞–∂–∞–º–∏