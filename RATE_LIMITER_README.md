# Rate Limiter Documentation

## –û–±–∑–æ—Ä

–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞–º–∏ API –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –æ—à–∏–±–æ–∫ 429 (Too Many Requests) –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å WildBerries –∏ Ozon API.

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ª–∏–º–∏—Ç–æ–≤

### WildBerries API
- **wb_general**: 300 req/min, 200ms –∏–Ω—Ç–µ—Ä–≤–∞–ª, 20 burst —Ç–æ–∫–µ–Ω–æ–≤
- **wb_advertising**: 100 req/min, 600ms –∏–Ω—Ç–µ—Ä–≤–∞–ª, 5 burst —Ç–æ–∫–µ–Ω–æ–≤ (–∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ)

### Ozon API
- **ozon_general**: 60 req/min, 1000ms –∏–Ω—Ç–µ—Ä–≤–∞–ª, 10 burst —Ç–æ–∫–µ–Ω–æ–≤
- **ozon_performance**: 60 req/min, 1000ms –∏–Ω—Ç–µ—Ä–≤–∞–ª, 10 burst —Ç–æ–∫–µ–Ω–æ–≤

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ

```python
from rate_limiter import with_rate_limit

# –ü–µ—Ä–µ–¥ API –∑–∞–ø—Ä–æ—Å–æ–º
await with_rate_limit('wb_advertising')
# –≤–∞—à API –∑–∞–ø—Ä–æ—Å –∑–¥–µ—Å—å
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ 429 –æ—à–∏–±–æ–∫

```python
from rate_limiter import rate_limiter

# –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ 429 –æ—à–∏–±–∫–∏
await rate_limiter.handle_429_error('wb_advertising', attempt_number)
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```python
from rate_limiter import get_rate_limit_stats
from rate_limiter_monitor import monitor_api_usage

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
stats = get_rate_limit_stats()

# –î–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç
report = await monitor_api_usage()
```

## –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã

1. **Token Bucket**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º "–∫–æ—Ä–∑–∏–Ω—ã —Ç–æ–∫–µ–Ω–æ–≤"
2. **Burst Control**: –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –ø–∏–∫–æ–≤—ã–µ –Ω–∞–≥—Ä—É–∑–∫–∏
3. **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã**: –†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
4. **–≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞**: –ü—Ä–∏ 429 –æ—à–∏–±–∫–∞—Ö

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤:
- `WildberriesAPI.get_advertising_campaigns()`
- `WildberriesAPI.get_advertising_statistics()`
- `OzonAPI.get_product_reviews()`
- `OzonAPI.get_product_stocks()`

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –ö–æ–º–∞–Ω–¥—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

```python
# –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö API
await monitor_api_usage()

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ rate limiter
await simulate_rate_limiting_test()

# –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
get_rate_limiter_recommendations()

# –°–±—Ä–æ—Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
await reset_rate_limiter_stats()
```

### –ü—Ä–∏–º–µ—Ä—ã –≤—ã–≤–æ–¥–∞

```
üìä Rate Limiter Status Report

üîπ WB_ADVERTISING
   ‚Ä¢ –ó–∞–ø—Ä–æ—Å—ã: 15/100 req/min
   ‚Ä¢ Burst —Ç–æ–∫–µ–Ω—ã: 3/5
   ‚Ä¢ –ú–∏–Ω. –∏–Ω—Ç–µ—Ä–≤–∞–ª: 600ms
   ‚Ä¢ ‚úÖ –ù–∏–∑–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞: 15.0%

üîπ OZON_GENERAL
   ‚Ä¢ –ó–∞–ø—Ä–æ—Å—ã: 5/60 req/min
   ‚Ä¢ Burst —Ç–æ–∫–µ–Ω—ã: 8/10
   ‚Ä¢ –ú–∏–Ω. –∏–Ω—Ç–µ—Ä–≤–∞–ª: 1000ms
   ‚Ä¢ ‚úÖ –ù–∏–∑–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞: 8.3%
```

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ API —Ç–∏–ø—ã**:
   - `wb_advertising` –¥–ª—è —Ä–µ–∫–ª–∞–º–Ω–æ–≥–æ API WB
   - `ozon_general` –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ API Ozon

2. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –Ω–∞–≥—Ä—É–∑–∫—É**: –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

3. **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ 429 –æ—à–∏–±–∫–∏**: –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ retry —Å rate limiter

4. **–ì—Ä—É–ø–ø–∏—Ä—É–π—Ç–µ –∑–∞–ø—Ä–æ—Å—ã**: –ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ API –≤—ã–∑–æ–≤–æ–≤

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

Rate limiter –ª–æ–≥–∏—Ä—É–µ—Ç:
- –ü—Ä–µ–≤—ã—à–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤ (INFO —É—Ä–æ–≤–µ–Ω—å)
- 429 –æ—à–∏–±–∫–∏ –∏ –∑–∞–¥–µ—Ä–∂–∫–∏ (WARNING —É—Ä–æ–≤–µ–Ω—å)
- –î–µ—Ç–∞–ª—å–Ω—É—é –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é (DEBUG —É—Ä–æ–≤–µ–Ω—å)

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –¥—Ä—É–≥–∏—Ö API

–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ API:

```python
# –í rate_limiter.py –¥–æ–±–∞–≤–∏—Ç—å –≤ CONFIGS
'new_api': RateLimitConfig(
    requests_per_minute=120,
    min_interval_ms=500,
    burst_limit=15
)
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- ‚úÖ –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ 429 –æ—à–∏–±–æ–∫
- ‚úÖ –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API –ª–∏–º–∏—Ç–æ–≤
- ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –æ—à–∏–±–æ–∫