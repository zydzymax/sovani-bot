# –ü–û–õ–ù–´–ô –ê–ù–ê–õ–ò–ó –°–ò–°–¢–ï–ú–´ SOVANI BOT - –ë–ï–ó –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞**: 2025-10-05
**–†–µ–∂–∏–º**: –¢–æ–ª—å–∫–æ –∞–Ω–∞–ª–∏–∑, –ë–ï–ó –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

---

## 1. –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê

### 1.1 –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
```
/root/sovani_bot/          ‚Üê –û–°–ù–û–í–ù–û–ô –ø—Ä–æ–µ–∫—Ç (SQLite, 315 Python —Ñ–∞–π–ª–æ–≤)
/root/sovani_api/          ‚Üê –°–¢–ê–†–´–ô –ø—Ä–æ–µ–∫—Ç (PostgreSQL, deprecated)
/root/sovani_crosspost/    ‚Üê –û—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç (–∫—Ä–æ—Å—Å–ø–æ—Å—Ç–∏–Ω–≥)
```

### 1.2 –ê–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
```
‚úÖ sovani-bot.service             - Telegram –±–æ—Ç (minimal_bot.py)
‚úÖ sovani-web.service             - TMA API backend (FastAPI –Ω–∞ –ø–æ—Ä—Ç—É 8000)
‚ùå sovani-replies-worker.service  - Auto-restart loop (–ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è)
‚úÖ sovani-ai-seller.service       - Docker Compose (exited, –Ω–æ active)
```

---

## 2. –ë–ê–ó–ê –î–ê–ù–ù–´–• - –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê

### 2.1 –ü—É—Ç—å –∫ –ë–î
`/root/sovani_bot/sovani_bot.db` (SQLite)

### 2.2 –¢–∞–±–ª–∏—Ü—ã –∏ –¥–∞–Ω–Ω—ã–µ
```
reviews:              55 rows  ‚úÖ –ï–°–¢–¨ –î–ê–ù–ù–´–ï (–Ω–æ –Ω–µ—Ç marketplace –ø–æ–ª—è!)
daily_sales:          0 rows   ‚ùå –ü–£–°–¢–û
daily_stock:          0 rows   ‚ùå –ü–£–°–¢–û
sku:                  0 rows   ‚ùå –ü–£–°–¢–û
organizations:        1 row    ‚úÖ
users:                1 row    ‚úÖ
org_members:          1 row    ‚úÖ
```

### 2.3 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã reviews
```sql
id                 TEXT PRIMARY KEY
sku                TEXT (nullable)
text               TEXT
rating             INTEGER (nullable)
has_media          BOOLEAN
answer             TEXT
date               TIMESTAMP
answered           BOOLEAN
reply_text         VARCHAR (nullable)
first_reply_at_utc DATETIME (nullable)
reply_kind         VARCHAR(10) (nullable)
created_at_utc     DATETIME (nullable)
org_id             INTEGER

‚ö†Ô∏è –û–¢–°–£–¢–°–¢–í–£–ï–¢: marketplace (–ø–æ–ª–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ë–î!)
```

### 2.4 –ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö reviews
```
ID: 92wHoIk4rD1rJNd... | SKU: 215819984 | Rating: 5 | Text: (–ø—É—Å—Ç–æ) | Answered: 0
ID: 4XACGgrMNwjWa6k... | SKU: 168894684 | Rating: 5 | Text: (–ø—É—Å—Ç–æ) | Answered: 0
ID: 3FhvGLmZjpn3CpI... | SKU: 182906670 | Rating: 5 | Text: –í—ã–±–æ—Ä –≤ –ø–æ–ª—å–∑—É –¥—Ä—É–≥–æ –ø–∏–∂–∞–º—É —Å –∫–∏–º–æ–Ω–æ | Answered: 0
```

**–ü–†–û–ë–õ–ï–ú–´**:
- –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –æ—Ç–∑—ã–≤–æ–≤ –∏–º–µ—é—Ç **–ø—É—Å—Ç–æ–π —Ç–µ–∫—Å—Ç**
- –ù–∏ –æ–¥–∏–Ω –æ—Ç–∑—ã–≤ –Ω–µ –∏–º–µ–µ—Ç –æ—Ç–≤–µ—Ç–∞ (answered=0)
- –ù–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–µ (WB/Ozon)
- –ù–µ–ø–æ–Ω—è—Ç–Ω–æ –æ—Ç–∫—É–¥–∞ –≤–∑—è—Ç—ã —ç—Ç–∏ –æ—Ç–∑—ã–≤—ã

---

## 3. –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø (.env)

### 3.1 API Tokens
```bash
BOT_TOKEN=8320329020:AAF-JeUX08V2eQHsnT8pX51_lB1-zFQENO8  ‚úÖ –†–µ–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω
TELEGRAM_TOKEN=${BOT_TOKEN}                                ‚úÖ
TZ=DEV_MODE                                                 ‚úÖ DEV —Ä–µ–∂–∏–º –≤–∫–ª—é—á–µ–Ω

# WB API - –í–°–ï PLACEHOLDER!
WB_FEEDBACKS_TOKEN=placeholder_wb_1      ‚ùå –ù–ï –ù–ê–°–¢–†–û–ï–ù–û
WB_ADS_TOKEN=placeholder_wb_2            ‚ùå –ù–ï –ù–ê–°–¢–†–û–ï–ù–û
WB_STATS_TOKEN=placeholder_wb_3          ‚ùå –ù–ï –ù–ê–°–¢–†–û–ï–ù–û
WB_SUPPLY_TOKEN=placeholder_wb_4         ‚ùå –ù–ï –ù–ê–°–¢–†–û–ï–ù–û
WB_ANALYTICS_TOKEN=placeholder_wb_5      ‚ùå –ù–ï –ù–ê–°–¢–†–û–ï–ù–û
WB_CONTENT_TOKEN=placeholder_wb_6        ‚ùå –ù–ï –ù–ê–°–¢–†–û–ï–ù–û

# Ozon API - –¢–û–ñ–ï PLACEHOLDER!
OZON_CLIENT_ID=placeholder_ozon_client   ‚ùå –ù–ï –ù–ê–°–¢–†–û–ï–ù–û
OZON_API_KEY_ADMIN=placeholder_ozon_key  ‚ùå –ù–ï –ù–ê–°–¢–†–û–ï–ù–û
```

**–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê**: –í—Å–µ API —Ç–æ–∫–µ–Ω—ã –¥–ª—è WB –∏ Ozon - —ç—Ç–æ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã!
–°–∏—Å—Ç–µ–º–∞ –Ω–µ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤.

---

## 4. –°–ö–†–ò–ü–¢ –°–ë–û–†–ê –î–ê–ù–ù–´–•

### 4.1 –§–∞–π–ª: `/root/sovani_bot/collect_recent_data.py`
```python
async def main():
    # –°–æ–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π
    wb_sales_count = await collect_wb_sales_range(db, d_from, d_to)
    wb_stocks_count = await collect_wb_stocks_now(db)
    ozon_txn_count = await collect_ozon_transactions_range(db, d_from, d_to)
    ozon_stocks_count = await collect_ozon_stocks_now(db)
```

**–ü–†–û–ë–õ–ï–ú–ê**: –°–∫—Ä–∏–ø—Ç –µ—Å—Ç—å, –Ω–æ:
- –ù–µ –∑–∞–ø—É—â–µ–Ω (–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ daily_sales/daily_stock)
- –ë—É–¥–µ—Ç –ø–∞–¥–∞—Ç—å —Å –æ—à–∏–±–∫–æ–π –∏–∑-–∑–∞ placeholder —Ç–æ–∫–µ–Ω–æ–≤
- –ù–µ—Ç systemd service –∏–ª–∏ cron job –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞

---

## 5. API ENDPOINTS - –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–¨

### 5.1 –†–∞–±–æ—Ç–∞—é—â–∏–µ endpoints
```
‚úÖ GET  /api/v1/reviews              - –°–ø–∏—Å–æ–∫ –æ—Ç–∑—ã–≤–æ–≤ (55 —à—Ç—É–∫)
‚úÖ GET  /api/v1/dashboard/summary    - –î–∞—à–±–æ—Ä–¥ (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 0 –≤–µ–∑–¥–µ)
‚úÖ GET  /api/v1/inventory/stocks     - –û—Å—Ç–∞—Ç–∫–∏ (–ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤)
‚úÖ GET  /health                      - Health check
```

### 5.2 –°–ª–æ–º–∞–Ω–Ω—ã–µ endpoints
```
‚ùå POST /api/v1/reviews/{id}/draft   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–Ω–æ–≤–∏–∫–∞ –æ—Ç–≤–µ—Ç–∞
   –û—à–∏–±–∫–∞: "build_reply_for_review() takes 1 positional argument but 2 were given"

‚ùå POST /api/v1/reviews/{id}/reply   - –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–∞
   –û—à–∏–±–∫–∞: –ó–∞–≤–∏—Å–∏—Ç –æ—Ç /draft, —Ç–æ–∂–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
```

### 5.3 –û—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö
```
sqlite3.OperationalError: no such column: reviews.review_id
```

**–ü—Ä–∏—á–∏–Ω–∞**:
- –ö–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `Review.review_id`
- –ë–î –∏–º–µ–µ—Ç –ø–æ–ª–µ `id`, –∞ –Ω–µ `review_id`
- –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –º–µ–∂–¥—É –º–æ–¥–µ–ª—å—é SQLAlchemy –∏ —Ä–µ–∞–ª—å–Ω–æ–π —Å—Ö–µ–º–æ–π –ë–î

---

## 6. –ü–†–û–ë–õ–ï–ú–´ –í –ö–û–î–ï

### 6.1 –§–∞–π–ª: `app/services/reviews_service.py`

**–°—Ç—Ä–æ–∫–∞ 65**:
```python
stmt = select(Review).where(Review.review_id == review_id, Review.org_id == org_id)
```
‚ùå –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `Review.review_id`, –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–µ—Ç –≤ –ë–î (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `Review.id`)

**–°—Ç—Ä–æ–∫–∞ 156**:
```python
db.execute(
    update(Review)
    .where(Review.review_id == review_id)  # ‚ùå review_id –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    ...
)
```

### 6.2 –§–∞–π–ª: `app/web/routers/reviews.py`

**–°—Ç—Ä–æ–∫–∞ 105**:
```python
draft_text = await build_reply_for_review(review_id, db)
```
‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å–∏–≥–Ω–∞—Ç—É—Ä–∞ –≤—ã–∑–æ–≤–∞

–§—É–Ω–∫—Ü–∏—è `build_reply_for_review` –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –∫–∞–∫:
```python
async def build_reply_for_review(db: Session, *, org_id: int, review_id: str) -> str:
```

–ù–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫:
```python
await build_reply_for_review(review_id, db)  # ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤!
```

**–ü—Ä–∞–≤–∏–ª—å–Ω–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å**:
```python
await build_reply_for_review(db, org_id=org_id, review_id=review_id)
```

### 6.3 –§–∞–π–ª: `app/db/models.py`

**–°—Ç—Ä–æ–∫–∏ 193-197**:
```python
class Review(Base):
    __tablename__ = "reviews"

    id: Mapped[str] = mapped_column(String(64), primary_key=True)
    sku: Mapped[str | None] = mapped_column(String, nullable=True)
```

‚úÖ –ú–æ–¥–µ–ª—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `id` –∏ `sku`

‚ùå –ù–û –∫–æ–¥ –≤ reviews_service.py –≤—Å–µ –µ—â–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞—Ä—ã–µ –∏–º–µ–Ω–∞:
- `Review.review_id` –≤–º–µ—Å—Ç–æ `Review.id`
- `Review.sku_id` –≤–º–µ—Å—Ç–æ `Review.sku`

### 6.4 –§–∞–π–ª: `app/web/routers/reviews.py` - –í—ã–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö

**–°—Ç—Ä–æ–∫–∏ 63-77**:
```python
return [
    ReviewDTO(
        review_id=r.id,                    # ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
        marketplace="WB",                  # ‚ùå –•–ê–†–î–ö–û–î! –í—Å–µ–≥–¥–∞ "WB"
        sku_key=r.sku,                     # ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
        rating=r.rating,
        text=r.text,
        ...
    )
]
```

**–ü–†–û–ë–õ–ï–ú–ê**: `marketplace` –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç "WB", –¥–∞–∂–µ –µ—Å–ª–∏ –æ—Ç–∑—ã–≤ —Å Ozon!
–ü–æ—Ç–æ–º—É —á—Ç–æ –≤ –ë–î –Ω–µ—Ç —ç—Ç–æ–≥–æ –ø–æ–ª—è.

---

## 7. TMA FRONTEND (static/index.html)

### 7.1 –§—É–Ω–∫—Ü–∏–∏
```javascript
‚úÖ openReviews()    - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—Ç–∑—ã–≤—ã (—Ä–∞–±–æ—Ç–∞–µ—Ç)
‚ùå openInventory()  - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—Å—Ç–∞—Ç–∫–∏ (–ø—É—Å—Ç–æ, –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö)
‚ùå openFinance()    - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ñ–∏–Ω–∞–Ω—Å—ã (–≤—Å–µ 0)
```

### 7.2 –ù–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –æ—Ç–∑—ã–≤—ã
```javascript
// –ö–æ–¥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –°–ü–ò–°–û–ö –æ—Ç–∑—ã–≤–æ–≤:
data.forEach(review => {
    html += `<div class="data-row">`;
    html += `<span class="data-label">‚≠ê ${review.rating}/5</span>`;
    html += `<span class="data-value">${review.text.substring(0, 30)}...</span>`;
    html += `</div>`;
});
```

‚ùå **–ù–ï–¢**:
- –ö–Ω–æ–ø–æ–∫ –¥–ª—è –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –æ—Ç–∑—ã–≤
- –ú–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–ª—è –Ω–∞–ø–∏—Å–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞
- –í—ã–∑–æ–≤–∞ API `/reviews/{id}/draft`
- –í—ã–∑–æ–≤–∞ API `/reviews/{id}/reply`
- –§—É–Ω–∫—Ü–∏–∏ –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç–∞ –Ω–∞ –≤—Å–µ –æ—Ç–∑—ã–≤—ã

**Frontend —Ç–æ–ª—å–∫–æ –ß–ò–¢–ê–ï–¢ –æ—Ç–∑—ã–≤—ã, –Ω–µ –º–æ–∂–µ—Ç –Ω–∞ –Ω–∏—Ö –æ—Ç–≤–µ—á–∞—Ç—å!**

---

## 8. –°–ò–°–¢–ï–ú–ù–´–ï –§–ê–ô–õ–´

### 8.1 `/etc/systemd/system/sovani-bot.service`
```ini
ExecStart=/usr/bin/flock -n /var/run/sovani_bot.lock /usr/bin/python3 /root/sovani_bot/minimal_bot.py
Environment="BOT_TOKEN=8320329020:AAF-JeUX08V2eQHsnT8pX51_lB1-zFQENO8"
```
‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### 8.2 `/etc/systemd/system/sovani-web.service`
```ini
ExecStart=/usr/bin/python3 -m uvicorn app.web.main:app --host 0.0.0.0 --port 8000
EnvironmentFile=-/root/sovani_bot/.env
```
‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### 8.3 `/etc/systemd/system/sovani-replies-worker.service`
```
Active: activating (auto-restart)
```
‚ùå –ü–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è (–∫—Ä–∞—à-–ª—É–ø)

---

## 9. –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –ü–†–û–ë–õ–ï–ú

### 9.1 –î–≤–∞ –ø—Ä–æ–µ–∫—Ç–∞ –≤–º–µ—Å—Ç–æ –æ–¥–Ω–æ–≥–æ
```
sovani_bot/     ‚Üê –û—Å–Ω–æ–≤–Ω–æ–π (SQLite, 55 –æ—Ç–∑—ã–≤–æ–≤, 0 –ø—Ä–æ–¥–∞–∂)
sovani_api/     ‚Üê –°—Ç–∞—Ä—ã–π (PostgreSQL, deprecated –Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç replies_worker)
```

**–ü–†–û–ë–õ–ï–ú–ê**: Replies worker –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏–∑ `/root/sovani_api/`, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥—Ä—É–≥—É—é –ë–î!

### 9.2 –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ö–µ–º –ë–î –∏ –∫–æ–¥–∞
```
–ë–î –∏–º–µ–µ—Ç:        –ö–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:
id               review_id      ‚ùå –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ
sku              sku_id         ‚ùå –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ
(–Ω–µ—Ç –ø–æ–ª—è)       marketplace    ‚ùå –•–∞—Ä–¥–∫–æ–¥ "WB"
```

### 9.3 Placeholder —Ç–æ–∫–µ–Ω—ã
```
WB API:   placeholder_wb_1..6   ‚ùå –ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
Ozon API: placeholder_ozon_*    ‚ùå –ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
```

---

## 10. –û–¢–°–£–¢–°–¢–í–£–Æ–©–ò–ô –§–£–ù–ö–¶–ò–û–ù–ê–õ

### 10.1 ‚ùå –û—Ç–≤–µ—Ç—ã –Ω–∞ –æ—Ç–∑—ã–≤—ã —á–µ—Ä–µ–∑ TMA
- –ù–µ—Ç UI –¥–ª—è –æ—Ç–≤–µ—Ç–∞
- –ù–µ—Ç –∫–Ω–æ–ø–∫–∏ "–û—Ç–≤–µ—Ç–∏—Ç—å"
- –ù–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–ª—è –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
- –ù–µ—Ç –≤—ã–∑–æ–≤–∞ `/draft` API
- –ù–µ—Ç –≤—ã–∑–æ–≤–∞ `/reply` API

### 10.2 ‚ùå –ê–≤—Ç–æ–æ—Ç–≤–µ—Ç –Ω–∞ –≤—Å–µ –æ—Ç–∑—ã–≤—ã
- –ù–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –º–∞—Å—Å–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –ù–µ—Ç –∫–Ω–æ–ø–∫–∏ "–û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤—Å–µ"
- –ù–µ—Ç batch processing –≤ backend

### 10.3 ‚ùå –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö —Å –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤
- –°–∫—Ä–∏–ø—Ç `collect_recent_data.py` –Ω–µ –∑–∞–ø—É—â–µ–Ω
- –ù–µ—Ç cron job / systemd timer
- Placeholder —Ç–æ–∫–µ–Ω—ã –Ω–µ –ø–æ–∑–≤–æ–ª—è—Ç —Å–æ–±—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ

### 10.4 ‚ùå –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤ (AI)
- Endpoint `/draft` —Å–ª–æ–º–∞–Ω (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã —Ñ—É–Ω–∫—Ü–∏–∏)
- OpenAI API key: `sk-placeholder_openai` ‚ùå

---

## 11. –ü–†–ò–ß–ò–ù–ê –ù–£–õ–ï–í–´–• –î–ê–ù–ù–´–•

### 11.1 Dashboard –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 0
```json
{"revenue_net":0.0,"profit":0.0,"margin":0.0,"units":0,"refunds_qty":0}
```

**–ü–†–ò–ß–ò–ù–ê**:
```sql
SELECT * FROM daily_sales;  -- 0 rows
SELECT * FROM daily_stock;  -- 0 rows
SELECT * FROM sku;          -- 0 rows
```

–¢–∞–±–ª–∏—Ü—ã –ø—É—Å—Ç—ã–µ ‚Üí –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞.

### 11.2 –ü–æ—á–µ–º—É —Ç–∞–±–ª–∏—Ü—ã –ø—É—Å—Ç—ã–µ?

1. **–ù–µ –∑–∞–ø—É—â–µ–Ω `collect_recent_data.py`**
2. **Placeholder —Ç–æ–∫–µ–Ω—ã WB/Ozon** ‚Üí API –≤—ã–∑–æ–≤—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç
3. **–ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏** (cron/systemd timer)

---

## 12. –û–¢–ö–£–î–ê –í–ó–Ø–õ–ò–°–¨ 55 –û–¢–ó–´–í–û–í?

**–í–æ–ø—Ä–æ—Å**: –í —Ç–∞–±–ª–∏—Ü–µ `reviews` –µ—Å—Ç—å 55 –∑–∞–ø–∏—Å–µ–π, –Ω–æ:
- `daily_sales` –ø—É—Å—Ç–∞—è
- `sku` –ø—É—Å—Ç–∞—è
- –¢–æ–∫–µ–Ω—ã placeholder

**–í–æ–∑–º–æ–∂–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã**:
1. –°—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
2. –†—É—á–Ω–∞—è –≤—Å—Ç–∞–≤–∫–∞ (testing)
3. –ò–º–ø–æ—Ä—Ç –∏–∑ CSV/JSON
4. –û—Å—Ç–∞—Ç–∫–∏ –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏ —Å–∏—Å—Ç–µ–º—ã

**–ü—Ä–æ–≤–µ—Ä–∫–∞**:
```sql
SELECT created_at_utc FROM reviews ORDER BY created_at_utc DESC LIMIT 5;
```
–î–∞—Ç—ã: 2025-09-23, 2025-09-21, 2025-08-02, 2025-07-16, 2025-07-14

–≠—Ç–æ **–†–ï–ê–õ–¨–ù–´–ï –¥–∞—Ç—ã** (–∏—é–ª—å-—Å–µ–Ω—Ç—è–±—Ä—å 2025), –∑–Ω–∞—á–∏—Ç:
- –õ–∏–±–æ –¥–∞–Ω–Ω—ã–µ –±—ã–ª–∏ —Å–æ–±—Ä–∞–Ω—ã –∫–æ–≥–¥–∞ —Ç–æ–∫–µ–Ω—ã –±—ã–ª–∏ –Ω–∞—Å—Ç–æ—è—â–∏–º–∏
- –õ–∏–±–æ —Å–∏—Å—Ç–µ–º–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª–∞ –∏—Ö –∏–∑ –¥—Ä—É–≥–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
- –õ–∏–±–æ —ç—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–º–∏ –¥–∞—Ç–∞–º–∏

---

## 13. –°–¢–†–£–ö–¢–£–†–ù–´–ï –û–®–ò–ë–ö–ò –ö–û–î–ê

### 13.1 –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∏–º–µ–Ω –ø–æ–ª–µ–π (3+ –º–µ—Å—Ç–∞)

**–§–∞–π–ª—ã —Å –æ—à–∏–±–∫–∞–º–∏**:
```
app/services/reviews_service.py:65     Review.review_id  ‚ùå
app/services/reviews_service.py:156    Review.review_id  ‚ùå
app/web/routers/export.py:198          r.id (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)  ‚úÖ
app/web/routers/reviews.py:63          r.id (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)  ‚úÖ
app/web/routers/reviews.py:108         Review.id         ‚úÖ
```

**–í—ã–≤–æ–¥**: –ö–æ–¥ —á–∞—Å—Ç–∏—á–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω, –Ω–æ `reviews_service.py` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞—Ä—ã–µ –∏–º–µ–Ω–∞.

### 13.2 –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏

**reviews.py:105**:
```python
draft_text = await build_reply_for_review(review_id, db)
```

**–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å–∏–≥–Ω–∞—Ç—É—Ä–∞**:
```python
async def build_reply_for_review(db: Session, *, org_id: int, review_id: str) -> str:
```

**–û—à–∏–±–∫–∞**: –ü–µ—Ä–µ–¥–∞–µ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç—ã –Ω–µ –≤ —Ç–æ–º –ø–æ—Ä—è–¥–∫–µ –∏ –±–µ–∑ keyword arguments.

### 13.3 –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–ª—è marketplace

**–ë–î**: –ù–µ—Ç –∫–æ–ª–æ–Ω–∫–∏ `marketplace`
**–ö–æ–¥**: –•–∞—Ä–¥–∫–æ–¥–∏—Ç `"WB"` –≤–µ–∑–¥–µ
**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç–ª–∏—á–∏—Ç—å –æ—Ç–∑—ã–≤—ã WB –æ—Ç Ozon

---

## 14. –ù–ï–î–û–°–¢–ê–Æ–©–ò–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´

### 14.1 UI –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –æ—Ç–∑—ã–≤—ã
```
‚ùå –ù–µ—Ç –≤ static/index.html:
   - –ö–Ω–æ–ø–∫–∞ "–û—Ç–≤–µ—Ç–∏—Ç—å" –Ω–∞ –∫–∞–∂–¥–æ–º –æ—Ç–∑—ã–≤–µ
   - –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –Ω–∞–ø–∏—Å–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞
   - –ü–æ–∫–∞–∑ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ AI —á–µ—Ä–Ω–æ–≤–∏–∫–∞
   - –ö–Ω–æ–ø–∫–∞ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç"
   - –ö–Ω–æ–ø–∫–∞ "–ê–≤—Ç–æ–æ—Ç–≤–µ—Ç –Ω–∞ –≤—Å–µ"
```

### 14.2 Batch processing API
```
‚ùå –ù–µ—Ç endpoint:
   POST /api/v1/reviews/reply-all
   {
     "filter": {"rating": [1,2], "answered": false},
     "template": "auto"
   }
```

### 14.3 Scheduled tasks
```
‚ùå –ù–µ—Ç systemd timer –¥–ª—è:
   - collect_recent_data.py (–µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π —Å–±–æ—Ä)
   - auto_reviews_processor.py (–∞–≤—Ç–æ–æ—Ç–≤–µ—Ç—ã)
```

### 14.4 –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```
‚ùå –ù–µ—Ç –∞–ª–µ—Ä—Ç–æ–≤ –Ω–∞:
   - –ü—É—Å—Ç—ã–µ —Ç–∞–±–ª–∏—Ü—ã (daily_sales, daily_stock, sku)
   - Placeholder —Ç–æ–∫–µ–Ω—ã –≤ .env
   - –ö—Ä–∞—à-–ª—É–ø sovani-replies-worker
```

---

## 15. –†–ê–ë–û–¢–ê–Æ–©–ò–ï –ß–ê–°–¢–ò –°–ò–°–¢–ï–ú–´

### 15.1 ‚úÖ Telegram Bot
- –ó–∞–ø—É—â–µ–Ω
- –û—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ /start
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫—É TMA
- URL: https://app.justbusiness.lol/

### 15.2 ‚úÖ TMA Frontend
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- –î–µ–ª–∞–µ—Ç API –∑–∞–ø—Ä–æ—Å—ã
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—Ç–∑—ã–≤—ã (55 —à—Ç—É–∫)

### 15.3 ‚úÖ FastAPI Backend
- –ó–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 8000
- DEV_MODE —Ä–∞–±–æ—Ç–∞–µ—Ç (–æ–±—Ö–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
- Endpoint /reviews —Ä–∞–±–æ—Ç–∞–µ—Ç
- Endpoint /dashboard/summary —Ä–∞–±–æ—Ç–∞–µ—Ç (–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 0)

### 15.4 ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- SQLite —Ä–∞–±–æ—Ç–∞–µ—Ç
- –°—Ö–µ–º–∞ —Å–æ–∑–¥–∞–Ω–∞ (27 —Ç–∞–±–ª–∏—Ü)
- –ï—Å—Ç—å 55 –æ—Ç–∑—ã–≤–æ–≤
- –ï—Å—Ç—å 1 –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è, 1 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

---

## 16. –ù–ï –†–ê–ë–û–¢–ê–Æ–©–ò–ï –ß–ê–°–¢–ò –°–ò–°–¢–ï–ú–´

### 16.1 ‚ùå –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –æ—Ç–∑—ã–≤—ã
- Endpoint `/draft` –ø–∞–¥–∞–µ—Ç —Å –æ—à–∏–±–∫–æ–π
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏
- OpenAI —Ç–æ–∫–µ–Ω placeholder

### 16.2 ‚ùå –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –æ—Ç–∑—ã–≤—ã
- Endpoint `/reply` —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏
- –ù–æ UI –¥–ª—è –≤—ã–∑–æ–≤–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
- –ù–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ—Å—Ç–∏–Ω–≥–∞ –≤ WB/Ozon (API –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç)

### 16.3 ‚ùå –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö —Å –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤
- –°–∫—Ä–∏–ø—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω
- Placeholder —Ç–æ–∫–µ–Ω—ã
- –¢–∞–±–ª–∏—Ü—ã –ø—É—Å—Ç—ã–µ (sales, stock, sku)

### 16.4 ‚ùå –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- –í—Å–µ –º–µ—Ç—Ä–∏–∫–∏ = 0
- –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞
- –§–æ—Ä–º—É–ª—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ, –Ω–æ –Ω–µ—á–µ–≥–æ —Å—á–∏—Ç–∞—Ç—å

### 16.5 ‚ùå –°–∫–ª–∞–¥—Å–∫–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- –¢–∞–±–ª–∏—Ü–∞ stock –ø—É—Å—Ç–∞—è
- Endpoint –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç []
- UI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–î–∞–Ω–Ω—ã—Ö –Ω–µ—Ç"

---

## 17. –°–ü–ò–°–û–ö –ë–ê–ì–û–í (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

### 17.1 üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï (–±–ª–æ–∫–∏—Ä—É—é—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª)

1. **Placeholder API —Ç–æ–∫–µ–Ω—ã WB/Ozon**
   - –§–∞–π–ª: `.env`
   - –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Å –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤
   - –ì–¥–µ –Ω—É–∂–Ω—ã –Ω–∞—Å—Ç–æ—è—â–∏–µ: WB_FEEDBACKS_TOKEN, WB_STATS_TOKEN, WB_SUPPLY_TOKEN, OZON_CLIENT_ID, OZON_API_KEY_ADMIN

2. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ build_reply_for_review()**
   - –§–∞–π–ª: `app/web/routers/reviews.py:105`
   - –ü—Ä–æ–±–ª–µ–º–∞: `await build_reply_for_review(review_id, db)` - –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫
   - –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `await build_reply_for_review(db, org_id=org_id, review_id=review_id)`

3. **Review.review_id –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ë–î**
   - –§–∞–π–ª: `app/services/reviews_service.py:65, 156`
   - –ü—Ä–æ–±–ª–µ–º–∞: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `Review.review_id`, –Ω–æ –≤ –ë–î –ø–æ–ª–µ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è `id`
   - –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `Review.id`

4. **–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç UI –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤**
   - –§–∞–π–ª: `static/index.html`
   - –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ—Ç –∫–Ω–æ–ø–æ–∫, –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞, –≤—ã–∑–æ–≤–æ–≤ API
   - –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å: –ö–Ω–æ–ø–∫–∞ "–û—Ç–≤–µ—Ç–∏—Ç—å", –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å `/draft` –∏ `/reply`

### 17.2 üü† –í–ê–ñ–ù–´–ï (–¥–∞–Ω–Ω—ã–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç)

5. **–ü—É—Å—Ç—ã–µ —Ç–∞–±–ª–∏—Ü—ã daily_sales, daily_stock, sku**
   - –ü—Ä–∏—á–∏–Ω–∞: `collect_recent_data.py` –Ω–µ –∑–∞–ø—É—â–µ–Ω
   - –†–µ—à–µ–Ω–∏–µ: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç–æ–∫–µ–Ω—ã + –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç + –¥–æ–±–∞–≤–∏—Ç—å –≤ cron/systemd timer

6. **Placeholder OpenAI —Ç–æ–∫–µ–Ω**
   - –§–∞–π–ª: `.env`
   - –ü—Ä–æ–±–ª–µ–º–∞: `OPENAI_API_KEY=sk-placeholder_openai`
   - –†–µ–∑—É–ª—å—Ç–∞—Ç: AI –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

7. **sovani-replies-worker –≤ –∫—Ä–∞—à-–ª—É–ø–µ**
   - –°–µ—Ä–≤–∏—Å: `sovani-replies-worker.service`
   - –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
   - –ó–∞–ø—É—Å–∫–∞–µ—Ç: `/root/sovani_api/replies_worker.py` (—Å—Ç–∞—Ä—ã–π –ø—Ä–æ–µ–∫—Ç!)

### 17.3 üü° –°–†–ï–î–ù–ò–ï (—É–ª—É—á—à–µ–Ω–∏—è)

8. **–ù–µ—Ç –ø–æ–ª—è marketplace –≤ –ë–î**
   - –¢–∞–±–ª–∏—Ü–∞: `reviews`
   - –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç–ª–∏—á–∏—Ç—å WB –æ—Ç Ozon
   - –ö–æ–¥ —Ö–∞—Ä–¥–∫–æ–¥–∏—Ç: `marketplace="WB"` –≤–µ–∑–¥–µ

9. **–ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö**
   - –ù–µ—Ç systemd timer –¥–ª—è `collect_recent_data.py`
   - –î–∞–Ω–Ω—ã–µ –Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

10. **–ù–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –º–∞—Å—Å–æ–≤–æ–≥–æ –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç–∞**
    - –ù–µ—Ç endpoint `/reviews/reply-all`
    - –ù–µ—Ç UI –∫–Ω–æ–ø–∫–∏ "–û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤—Å–µ"

---

## 18. –ß–¢–û –†–ê–ë–û–¢–ê–ï–¢ –°–ï–ô–ß–ê–° (–§–ê–ö–¢–´)

### 18.1 Telegram Bot
- ‚úÖ –ó–∞–ø—É—â–µ–Ω —á–µ—Ä–µ–∑ systemd
- ‚úÖ –û—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—ã
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫—É TMA —Å URL
- ‚úÖ –¢–æ–∫–µ–Ω –Ω–∞—Å—Ç–æ—è—â–∏–π (8320329020:...)

### 18.2 TMA Web App
- ‚úÖ –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø–æ https://app.justbusiness.lol/
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- ‚úÖ –î–µ–ª–∞–µ—Ç API –∑–∞–ø—Ä–æ—Å—ã
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ 55 –æ—Ç–∑—ã–≤–æ–≤
- ‚ùå –ù–µ –º–æ–∂–µ—Ç –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –æ—Ç–∑—ã–≤—ã (–Ω–µ—Ç UI)
- ‚ùå –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç 0 –ø–æ —Ñ–∏–Ω–∞–Ω—Å–∞–º (–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö)
- ‚ùå –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—É—Å—Ç–æ –ø–æ –æ—Å—Ç–∞—Ç–∫–∞–º (–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö)

### 18.3 API Backend
- ‚úÖ FastAPI —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 8000
- ‚úÖ DEV_MODE –∞–∫—Ç–∏–≤–µ–Ω (TZ=DEV_MODE)
- ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –æ–±—Ö–æ–¥–∏—Ç—Å—è
- ‚úÖ GET /reviews —Ä–∞–±–æ—Ç–∞–µ—Ç (55 –∑–∞–ø–∏—Å–µ–π)
- ‚úÖ GET /dashboard/summary —Ä–∞–±–æ—Ç–∞–µ—Ç (–Ω–æ 0 –≤–µ–∑–¥–µ)
- ‚úÖ GET /inventory/stocks —Ä–∞–±–æ—Ç–∞–µ—Ç (–Ω–æ –ø—É—Å—Ç–æ–π [])
- ‚ùå POST /reviews/{id}/draft –ø–∞–¥–∞–µ—Ç —Å –æ—à–∏–±–∫–æ–π
- ‚ùå POST /reviews/{id}/reply —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –Ω–µ—Ç UI

### 18.4 –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ SQLite –ø–æ–¥–∫–ª—é—á–µ–Ω–∞
- ‚úÖ 27 —Ç–∞–±–ª–∏—Ü —Å–æ–∑–¥–∞–Ω—ã
- ‚úÖ 55 –æ—Ç–∑—ã–≤–æ–≤ –µ—Å—Ç—å
- ‚úÖ 1 –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è, 1 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- ‚ùå 0 –ø—Ä–æ–¥–∞–∂
- ‚ùå 0 –æ—Å—Ç–∞—Ç–∫–æ–≤
- ‚ùå 0 SKU
- ‚ö†Ô∏è –ù–µ–ø–æ–Ω—è—Ç–Ω–æ –æ—Ç–∫—É–¥–∞ –≤–∑—è–ª–∏—Å—å 55 –æ—Ç–∑—ã–≤–æ–≤ (–≤–µ—Ä–æ—è—Ç–Ω–æ —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–ª–∏ –∏–º–ø–æ—Ä—Ç)

---

## 19. –ß–¢–û –ù–ï –†–ê–ë–û–¢–ê–ï–¢ (–§–ê–ö–¢–´)

### 19.1 –û—Ç–≤–µ—Ç—ã –Ω–∞ –æ—Ç–∑—ã–≤—ã
- ‚ùå –ù–µ—Ç –∫–Ω–æ–ø–∫–∏ "–û—Ç–≤–µ—Ç–∏—Ç—å" –≤ UI
- ‚ùå Endpoint `/draft` –ø–∞–¥–∞–µ—Ç (TypeError: –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã)
- ‚ùå –ù–µ—Ç AI –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (OpenAI —Ç–æ–∫–µ–Ω placeholder)
- ‚ùå –ù–µ—Ç –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç–∞ –Ω–∞ –≤—Å–µ –æ—Ç–∑—ã–≤—ã

### 19.2 –î–∞–Ω–Ω—ã–µ —Å –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤
- ‚ùå –í—Å–µ WB —Ç–æ–∫–µ–Ω—ã = placeholder
- ‚ùå –í—Å–µ Ozon —Ç–æ–∫–µ–Ω—ã = placeholder
- ‚ùå `collect_recent_data.py` –Ω–µ –∑–∞–ø—É—â–µ–Ω
- ‚ùå –¢–∞–±–ª–∏—Ü—ã sales/stock/sku –ø—É—Å—Ç—ã–µ

### 19.3 –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
- ‚ùå –§–∏–Ω–∞–Ω—Å—ã: –≤—Å–µ 0 (–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞)
- ‚ùå –û—Å—Ç–∞—Ç–∫–∏: –ø—É—Å—Ç–æ (—Ç–∞–±–ª–∏—Ü–∞ daily_stock –ø—É—Å—Ç–∞—è)
- ‚ùå SKU: –Ω–µ—Ç –≤ –ë–î (—Ç–∞–±–ª–∏—Ü–∞ sku –ø—É—Å—Ç–∞—è)

### 19.4 –ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å –æ—Ç–∑—ã–≤–æ–≤
- ‚ùå –ù–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ WB –∏–ª–∏ Ozon (–Ω–µ—Ç –ø–æ–ª—è marketplace –≤ –ë–î)
- ‚ùå –ö–æ–¥ —Ö–∞—Ä–¥–∫–æ–¥–∏—Ç "WB" –¥–ª—è –≤—Å–µ—Ö –æ—Ç–∑—ã–≤–æ–≤

### 19.5 –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è
- ‚ùå –ù–µ—Ç cron job –¥–ª—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚ùå –ù–µ—Ç systemd timer
- ‚ùå replies-worker –≤ –∫—Ä–∞—à-–ª—É–ø–µ
- ‚ùå –ù–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—É—Å—Ç—ã—Ö —Ç–∞–±–ª–∏—Ü

---

## 20. –ö–û–†–ù–ï–í–´–ï –ü–†–ò–ß–ò–ù–´ –ü–†–û–ë–õ–ï–ú

### 20.1 –ü—Ä–∏—á–∏–Ω–∞ ‚Ññ1: –ù–µ—Ç –Ω–∞—Å—Ç–æ—è—â–∏—Ö API —Ç–æ–∫–µ–Ω–æ–≤
```
–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å –ø—Ä–æ–¥–∞–∂–∏
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å –æ—Å—Ç–∞—Ç–∫–∏
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å SKU
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –æ—Ç–∑—ã–≤—ã
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –æ—Ç–∑—ã–≤—ã (API WB/Ozon –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç)
```

### 20.2 –ü—Ä–∏—á–∏–Ω–∞ ‚Ññ2: –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ö–µ–º—ã –ë–î –∏ –∫–æ–¥–∞
```
–ë–î:           –ö–æ–¥:
id            review_id    ‚Üê –ö–æ–¥ —É—Å—Ç–∞—Ä–µ–ª
sku           sku_id       ‚Üê –ö–æ–¥ —É—Å—Ç–∞—Ä–µ–ª
(–Ω–µ—Ç –ø–æ–ª—è)    marketplace  ‚Üê –ö–æ–¥ —Ö–∞—Ä–¥–∫–æ–¥–∏—Ç "WB"
```

### 20.3 –ü—Ä–∏—á–∏–Ω–∞ ‚Ññ3: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ UI –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤
```
static/index.html —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ:
- –ü–æ–∫–∞–∑ —Å–ø–∏—Å–∫–∞ –æ—Ç–∑—ã–≤–æ–≤
- –ù–ï —Å–æ–¥–µ—Ä–∂–∏—Ç:
  - –ö–Ω–æ–ø–∫–∏ –æ—Ç–≤–µ—Ç–∞
  - –ú–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
  - –í—ã–∑–æ–≤–æ–≤ /draft –∏ /reply API
```

### 20.4 –ü—Ä–∏—á–∏–Ω–∞ ‚Ññ4: –°–∫—Ä–∏–ø—Ç —Å–±–æ—Ä–∞ –Ω–µ –∑–∞–ø—É—â–µ–Ω
```
collect_recent_data.py —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ:
- –ù–µ –∑–∞–ø—É—â–µ–Ω –≤—Ä—É—á–Ω—É—é
- –ù–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ cron
- –ù–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ systemd timer
- –£–ø–∞–¥–µ—Ç —Å –æ—à–∏–±–∫–æ–π –∏–∑-–∑–∞ placeholder —Ç–æ–∫–µ–Ω–æ–≤
```

### 20.5 –ü—Ä–∏—á–∏–Ω–∞ ‚Ññ5: –î–≤–∞ –ø—Ä–æ–µ–∫—Ç–∞ –≤–º–µ—Å—Ç–æ –æ–¥–Ω–æ–≥–æ
```
/root/sovani_bot/   ‚Üê –û—Å–Ω–æ–≤–Ω–æ–π (SQLite, TMA, API)
/root/sovani_api/   ‚Üê –°—Ç–∞—Ä—ã–π (PostgreSQL, deprecated)
                      –ù–æ replies-worker –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –æ—Ç—Å—é–¥–∞!
```

---

## 21. –î–ï–¢–ê–õ–¨–ù–´–ô –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø (–¥–ª—è ChatGPT)

### –≠–¢–ê–ü 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ API —Ç–æ–∫–µ–Ω–æ–≤
```bash
# –§–∞–π–ª: .env
# –ó–∞–º–µ–Ω–∏—Ç—å placeholder –Ω–∞ –Ω–∞—Å—Ç–æ—è—â–∏–µ —Ç–æ–∫–µ–Ω—ã:
WB_FEEDBACKS_TOKEN=<–Ω–∞—Å—Ç–æ—è—â–∏–π —Ç–æ–∫–µ–Ω WB –¥–ª—è –æ—Ç–∑—ã–≤–æ–≤>
WB_STATS_TOKEN=<–Ω–∞—Å—Ç–æ—è—â–∏–π —Ç–æ–∫–µ–Ω WB –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏>
WB_SUPPLY_TOKEN=<–Ω–∞—Å—Ç–æ—è—â–∏–π —Ç–æ–∫–µ–Ω WB –¥–ª—è –ø–æ—Å—Ç–∞–≤–æ–∫>
WB_ANALYTICS_TOKEN=<–Ω–∞—Å—Ç–æ—è—â–∏–π —Ç–æ–∫–µ–Ω WB –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏>
WB_CONTENT_TOKEN=<–Ω–∞—Å—Ç–æ—è—â–∏–π —Ç–æ–∫–µ–Ω WB –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞>
OZON_CLIENT_ID=<–Ω–∞—Å—Ç–æ—è—â–∏–π Client ID Ozon>
OZON_API_KEY_ADMIN=<–Ω–∞—Å—Ç–æ—è—â–∏–π API Key Ozon>
OPENAI_API_KEY=<–Ω–∞—Å—Ç–æ—è—â–∏–π OpenAI API key>
```

### –≠–¢–ê–ü 2: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ë–î –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–π

**2.1. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ marketplace –≤ reviews**
```sql
ALTER TABLE reviews ADD COLUMN marketplace VARCHAR(10);
UPDATE reviews SET marketplace = 'WB';  -- –≤—Ä–µ–º–µ–Ω–Ω–æ, –ø–æ–∫–∞ –Ω–µ –∑–Ω–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫
```

**2.2. –û–±–Ω–æ–≤–∏—Ç—å –º–æ–¥–µ–ª—å Review**
```python
# app/db/models.py
class Review(Base):
    marketplace: Mapped[str | None] = mapped_column(String(10), nullable=True)
```

**2.3. –ò—Å–ø—Ä–∞–≤–∏—Ç—å reviews_service.py**
```python
# –°—Ç—Ä–æ–∫–∞ 65: Review.review_id ‚Üí Review.id
stmt = select(Review).where(Review.id == review_id, Review.org_id == org_id)

# –°—Ç—Ä–æ–∫–∞ 156: Review.review_id ‚Üí Review.id
db.execute(
    update(Review)
    .where(Review.id == review_id)
    ...
)
```

**2.4. –£–±—Ä–∞—Ç—å —Ö–∞—Ä–¥–∫–æ–¥ marketplace**
```python
# app/web/routers/reviews.py:65
# –ë—ã–ª–æ:
marketplace="WB",
# –°—Ç–∞–ª–æ:
marketplace=r.marketplace or "WB",  # fallback –µ—Å–ª–∏ null
```

### –≠–¢–ê–ü 3: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã–∑–æ–≤–∞ build_reply_for_review

**–§–∞–π–ª**: `app/web/routers/reviews.py:105`

**–ë—ã–ª–æ**:
```python
draft_text = await build_reply_for_review(review_id, db)
```

**–°—Ç–∞–ª–æ**:
```python
draft_text = await build_reply_for_review(db, org_id=org_id, review_id=review_id)
```

### –≠–¢–ê–ü 4: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ UI –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤

**–§–∞–π–ª**: `static/index.html`

**4.1. –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–û—Ç–≤–µ—Ç–∏—Ç—å" –≤ —Å–ø–∏—Å–æ–∫ –æ—Ç–∑—ã–≤–æ–≤**
```javascript
// –í —Ñ—É–Ω–∫—Ü–∏–∏ openReviews(), –ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 321:
html += `<button onclick="replyToReview('${review.review_id}')">–û—Ç–≤–µ—Ç–∏—Ç—å</button>`;
```

**4.2. –î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–Ω–æ–≤–∏–∫–∞**
```javascript
async function replyToReview(reviewId) {
    showModal('üí¨ –û—Ç–≤–µ—Ç –Ω–∞ –æ—Ç–∑—ã–≤', '<div class="loading">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞...</div>');

    try {
        const headers = initData ? {'X-Telegram-Init-Data': initData} : {};
        const response = await fetch(`/api/v1/reviews/${reviewId}/draft`, {
            method: 'POST',
            headers
        });

        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        const data = await response.json();

        // –ü–æ–∫–∞–∑–∞—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫ + –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏
        document.getElementById('modalBody').innerHTML = `
            <textarea id="replyText" style="width:100%;height:100px;">${data.draft_text}</textarea>
            <button onclick="sendReply('${reviewId}')">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç</button>
        `;
    } catch (error) {
        document.getElementById('modalBody').innerHTML =
            `<p style="color: #f44336;">‚ùå –û—à–∏–±–∫–∞: ${error.message}</p>`;
    }
}
```

**4.3. –î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞**
```javascript
async function sendReply(reviewId) {
    const replyText = document.getElementById('replyText').value;
    const headers = initData ? {'X-Telegram-Init-Data': initData} : {};

    const response = await fetch(`/api/v1/reviews/${reviewId}/reply`, {
        method: 'POST',
        headers: {...headers, 'Content-Type': 'application/json'},
        body: JSON.stringify({text: replyText})
    });

    if (response.ok) {
        alert('‚úÖ –û—Ç–≤–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!');
        closeModal();
    } else {
        alert('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏');
    }
}
```

**4.4. –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–ê–≤—Ç–æ–æ—Ç–≤–µ—Ç –Ω–∞ –≤—Å–µ"**
```javascript
// –í —Ñ—É–Ω–∫—Ü–∏–∏ openReviews(), –ø–æ—Å–ª–µ —Å–ø–∏—Å–∫–∞ –æ—Ç–∑—ã–≤–æ–≤:
html += `<button onclick="replyToAll()">ü§ñ –ê–≤—Ç–æ–æ—Ç–≤–µ—Ç –Ω–∞ –≤—Å–µ</button>`;

async function replyToAll() {
    if (!confirm('–û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤—Å–µ –Ω–µ–æ—Ç–≤–µ—á–µ–Ω–Ω—ã–µ –æ—Ç–∑—ã–≤—ã?')) return;

    const headers = initData ? {'X-Telegram-Init-Data': initData} : {};
    const response = await fetch('/api/v1/reviews?limit=100', {headers});
    const reviews = await response.json();

    for (const review of reviews.filter(r => !r.reply_status)) {
        await replyToReview(review.review_id);
        await new Promise(r => setTimeout(r, 1000)); // –∑–∞–¥–µ—Ä–∂–∫–∞ 1 —Å–µ–∫
    }

    alert('‚úÖ –í—Å–µ –æ—Ç–≤–µ—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã!');
}
```

### –≠–¢–ê–ü 5: –ó–∞–ø—É—Å–∫ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

**5.1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é**
```bash
cd /root/sovani_bot
python3 collect_recent_data.py
```

**5.2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç**
```bash
python3 -c "
import sqlite3
conn = sqlite3.connect('sovani_bot.db')
c = conn.cursor()
c.execute('SELECT COUNT(*) FROM daily_sales')
print(f'Sales: {c.fetchone()[0]}')
c.execute('SELECT COUNT(*) FROM daily_stock')
print(f'Stock: {c.fetchone()[0]}')
c.execute('SELECT COUNT(*) FROM sku')
print(f'SKU: {c.fetchone()[0]}')
conn.close()
"
```

**5.3. –î–æ–±–∞–≤–∏—Ç—å –≤ systemd timer**
```ini
# /etc/systemd/system/sovani-collect-data.service
[Unit]
Description=SoVAni Data Collection

[Service]
Type=oneshot
User=root
WorkingDirectory=/root/sovani_bot
EnvironmentFile=/root/sovani_bot/.env
ExecStart=/usr/bin/python3 /root/sovani_bot/collect_recent_data.py

# /etc/systemd/system/sovani-collect-data.timer
[Unit]
Description=Run SoVAni data collection daily

[Timer]
OnCalendar=daily
OnBootSec=5min
Persistent=true

[Install]
WantedBy=timers.target
```

```bash
systemctl daemon-reload
systemctl enable --now sovani-collect-data.timer
```

### –≠–¢–ê–ü 6: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ sovani-replies-worker

**6.1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç**
```bash
cat /etc/systemd/system/sovani-replies-worker.service
```

**6.2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—É—Ç—å**
–ï—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç `/root/sovani_api/replies_worker.py`, –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞:
```ini
ExecStart=/usr/bin/python3 /root/sovani_bot/auto_reviews_processor.py
```

–ò–ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç—å, –µ—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è:
```bash
systemctl disable --now sovani-replies-worker
```

### –≠–¢–ê–ü 7: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
systemctl daemon-reload
systemctl restart sovani-web
systemctl restart sovani-bot
systemctl status sovani-web
systemctl status sovani-bot
```

### –≠–¢–ê–ü 8: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**8.1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤**
```bash
curl -s -X POST 'http://localhost:8000/api/v1/reviews/1ZixpD57BDPhkLacaiIR/draft' | jq
```

**8.2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö**
```bash
curl -s 'http://localhost:8000/api/v1/dashboard/summary?date_from=2025-07-01&date_to=2025-12-31' | jq
```

**8.3. –ü—Ä–æ–≤–µ—Ä–∫–∞ TMA**
- –û—Ç–∫—Ä—ã—Ç—å @SoVAni_helper_bot
- –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É TMA
- –û—Ç–∫—Ä—ã—Ç—å —Ä–∞–∑–¥–µ–ª –û—Ç–∑—ã–≤—ã
- –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "–û—Ç–≤–µ—Ç–∏—Ç—å" –Ω–∞ –æ—Ç–∑—ã–≤–µ
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç

---

## 22. –§–ê–ô–õ–´ –¢–†–ï–ë–£–Æ–©–ò–ï –ò–ó–ú–ï–ù–ï–ù–ò–ô

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ:
```
‚úèÔ∏è app/db/models.py                     - –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ marketplace
‚úèÔ∏è app/services/reviews_service.py      - –ó–∞–º–µ–Ω–∏—Ç—å review_id –Ω–∞ id
‚úèÔ∏è app/web/routers/reviews.py           - –ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤—ã–∑–æ–≤ build_reply_for_review
‚úèÔ∏è app/web/routers/reviews.py           - –£–±—Ä–∞—Ç—å —Ö–∞—Ä–¥–∫–æ–¥ marketplace
‚úèÔ∏è static/index.html                    - –î–æ–±–∞–≤–∏—Ç—å UI –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤
```

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
```
‚úèÔ∏è .env                                 - –ù–∞—Å—Ç–æ—è—â–∏–µ API —Ç–æ–∫–µ–Ω—ã
‚úèÔ∏è /etc/systemd/system/sovani-collect-data.service   - –ù–æ–≤—ã–π
‚úèÔ∏è /etc/systemd/system/sovani-collect-data.timer     - –ù–æ–≤—ã–π
‚úèÔ∏è /etc/systemd/system/sovani-replies-worker.service - –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∏–ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç—å
```

### SQL –º–∏–≥—Ä–∞—Ü–∏–∏:
```sql
-- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ marketplace
ALTER TABLE reviews ADD COLUMN marketplace VARCHAR(10);
UPDATE reviews SET marketplace = 'WB' WHERE marketplace IS NULL;
```

---

## 23. –ò–¢–û–ì–û–í–ê–Ø –û–¶–ï–ù–ö–ê –°–û–°–¢–û–Ø–ù–ò–Ø

### ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç (30%):
- Telegram Bot
- TMA –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–∑—ã–≤—ã
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∞

### ‚ö†Ô∏è –†–∞–±–æ—Ç–∞–µ—Ç —á–∞—Å—Ç–∏—á–Ω–æ (20%):
- API endpoints (—á–∞—Å—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç, —á–∞—Å—Ç—å –ø–∞–¥–∞–µ—Ç)
- –î–∞–Ω–Ω—ã–µ (–µ—Å—Ç—å 55 –æ—Ç–∑—ã–≤–æ–≤, –Ω–µ—Ç sales/stock)

### ‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (50%):
- –û—Ç–≤–µ—Ç—ã –Ω–∞ –æ—Ç–∑—ã–≤—ã (–Ω–µ—Ç UI + –∫–æ–¥ —Å –±–∞–≥–∞–º–∏)
- –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö (placeholder —Ç–æ–∫–µ–Ω—ã)
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ (–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞)
- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (–Ω–µ—Ç scheduled tasks)

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
1. üî¥ **–°–†–û–ß–ù–û**: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ API —Ç–æ–∫–µ–Ω–æ–≤
2. üî¥ **–°–†–û–ß–ù–û**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ reviews_service.py (Review.id)
3. üî¥ **–°–†–û–ß–ù–û**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã–∑–æ–≤–∞ build_reply_for_review()
4. üü† **–í–ê–ñ–ù–û**: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ UI –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤
5. üü† **–í–ê–ñ–ù–û**: –ó–∞–ø—É—Å–∫ collect_recent_data.py
6. üü° **–ñ–ï–õ–ê–¢–ï–õ–¨–ù–û**: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è marketplace –≤ –ë–î
7. üü° **–ñ–ï–õ–ê–¢–ï–õ–¨–ù–û**: Systemd timer –¥–ª—è –∞–≤—Ç–æ—Å–±–æ—Ä–∞

---

## 24. –ó–ê–í–ò–°–ò–ú–û–°–¢–ò –ú–ï–ñ–î–£ –ü–†–û–ë–õ–ï–ú–ê–ú–ò

```
–ù–µ—Ç API —Ç–æ–∫–µ–Ω–æ–≤
    ‚Üì
–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ
    ‚Üì
–¢–∞–±–ª–∏—Ü—ã sales/stock/sku –ø—É—Å—Ç—ã–µ
    ‚Üì
Dashboard –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 0
    ‚Üì
TMA –Ω–µ –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑–∞—Ç—å —Ñ–∏–Ω–∞–Ω—Å—ã/–æ—Å—Ç–∞—Ç–∫–∏

---

Review.review_id –≤ –∫–æ–¥–µ
    ‚Üì
–ë–î –∏–º–µ–µ—Ç –ø–æ–ª–µ id
    ‚Üì
SQL –∑–∞–ø—Ä–æ—Å—ã –ø–∞–¥–∞—é—Ç —Å –æ—à–∏–±–∫–æ–π
    ‚Üì
Endpoint /draft –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
    ‚Üì
–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç—ã

---

–ù–µ—Ç UI –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤
    ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –Ω–∞–∂–∞—Ç—å "–û—Ç–≤–µ—Ç–∏—Ç—å"
    ‚Üì
–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –æ—Ç–≤–µ—Ç–æ–≤ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
    (–¥–∞–∂–µ –µ—Å–ª–∏ API —Ä–∞–±–æ—Ç–∞–µ—Ç)
```

---

## 25. –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

### –°–∏—Å—Ç–µ–º–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏:
**"–ß–∞—Å—Ç–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞—é—â–∏–π –ø—Ä–æ—Ç–æ—Ç–∏–ø —Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º–∏ –±–∞–≥–∞–º–∏"**

### –†–∞–±–æ—Ç–∞–µ—Ç:
- –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (systemd, nginx, –ë–î)
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (—Ç–µ —á—Ç–æ –µ—Å—Ç—å –≤ –ë–î)
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (DEV_MODE bypass)

### –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- –û—Ç–≤–µ—Ç—ã –Ω–∞ –æ—Ç–∑—ã–≤—ã (–±–∞–≥–∏ –≤ –∫–æ–¥–µ + –Ω–µ—Ç UI)
- –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö (–Ω–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤)
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ (–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö)

### –î–ª—è –ø–æ–ª–Ω–æ–π —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –Ω—É–∂–Ω–æ:
1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å API —Ç–æ–∫–µ–Ω—ã WB/Ozon/OpenAI
2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å 3 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –±–∞–≥–∞ –≤ –∫–æ–¥–µ
3. –î–æ–±–∞–≤–∏—Ç—å UI –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤
4. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö
5. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é

### –í—Ä–µ–º—è –Ω–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–æ—Ü–µ–Ω–∫–∞):
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤: 30 –º–∏–Ω—É—Ç
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–æ–≤: 1 —á–∞—Å
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ UI: 2 —á–∞—Å–∞
- –ó–∞–ø—É—Å–∫ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞: 1 —á–∞—Å
- **–ò—Ç–æ–≥–æ**: ~4-5 —á–∞—Å–æ–≤ —Ä–∞–±–æ—Ç—ã

---

**–ö–æ–Ω–µ—Ü –∞–Ω–∞–ª–∏–∑–∞**
